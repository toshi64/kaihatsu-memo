
# セッションIDとCSRFトークンの整理メモ

## 1. セッションIDとCSRFトークンの区別

- **セッションID**：受動的に送信される情報  
  - ブラウザが自動的に `Cookie` ヘッダーとしてリクエストに添付する  
  - ユーザーが何もしなくても送られる  
  - 代表例：`sessionid`

- **CSRFトークン**：明示的に送信が必要な情報  
  - HTMLフォームの hiddenフィールドや、JavaScriptでfetchのヘッダーに手動で付ける  
  - リクエストボディまたはHTTPヘッダーの `"X-CSRFToken"` に含める必要がある  
  - 代表例：`csrftoken`

---

## 2. 詐欺師（CSRF攻撃者）の視点からのシナリオ

### 詐欺の仕組み
- 詐欺師が自分のブログに、銀行Aへの「入金POSTリクエスト」を仕込んだフォームを用意
- そこに、すでに銀行Aにログイン済みのユーザーがアクセスしてきた（セッションが有効な状態）
- 詐欺師には、Cookieの中身であるセッションIDとCSRFトークンは読み取れないが・・・。

---

### パターン1：セッションIDのみのとき

- ブラウザは、自動的に `sessionid` をリクエストに添付してしまう  
- 銀行側は本人だと誤認 → **なりすまし成功**  
- **詐欺成立**

---

### パターン2：CSRFトークンありのとき
- CSRFトークンはリクエストに明示的に含める必要がある（sessionidのように、自動で添付されない）
- 詐欺師はユーザーの `csrftoken` をボディやヘッダーに含めることができない
- 銀行サーバーは「トークンが無い、または不一致」と判断 → **403 Forbidden**
- **詐欺失敗**

---

## 結論

- セッションIDだけではユーザーの「意図ある操作」は保証できない
- CSRFトークンは「本人による正規の操作である証拠」として機能する
- この二つの役割分担によって、セッション維持と不正防止が両立されている

