
# API駆動型UI設計ドキュメント（2025/05/07）

## 概要

本設計は、AIベースの英語診断ツールにおいて、UIの描画をサーバーから返却される「設計図（JSON）」に基づいて動的に制御する方式を採用する。これにより、問題形式・出題順・UI構造の切り替えを柔軟に実現可能とする。

---

## 設計思想：構造主導・意味駆動の分離

UIは以下の三層構造に分離され、それぞれが責務を持つ。

### 1. `page.js`: セッション・状態管理の中枢

* セッションID・CSRFトークンの取得と保持
* 出題APIから設計図（JSON）を受け取り、`questions[]` に蓄積
* 各設計図を `DynamicRenderer` に渡して描画を指示
* `onNext()` により新たな設計図を取得し追加

### 2. `DynamicRenderer`: 設計図の解析とUIルーティング

* JSONから `type` と `props` を分解
* `type` に基づいて対応する UIキット を選択
* `props` を構造ごとに分割し、UIキットへ渡す（中継・変換レイヤー）

### 3. UIキット（例：`EnglishWriting.jsx`）

* 特定の問題形式に対応したUIとロジックを持つ
* 必要最小限のローカル状態を保持（入力値、提出済み状態など）
* フォーム送信時には模範解答を即表示し、APIに送信、`onNext()` を呼び出す

---

## APIレスポンス仕様（設計図フォーマット）

```json
{
  "type": "english_writing",
  "id": "q1",
  "props": {
    "question_id": 1023,
    "question_number": 1,
    "question_text": "彼はサッカーが好きです。",
    "model_answer": "He likes soccer.",
    "submit_endpoint": "/submit/"
  }
}
```

### 解説

* `type` は `DynamicRenderer` におけるUI分岐の基準
* `id` はReact側の `key` などに使われる設問単位の識別子
* `props` はUIキットに渡される構造化データ（順序も固定化）

---

## メリット

* **問題形式の柔軟な切替が可能**（type単位で設計分岐）
* **設問ごとのロジック・UIを局所化**（責務の明確化）
* **UIの描画ロジックと出題ロジックが完全に分離**
* **将来的なA/Bテストやパーソナライズにも対応可能**
* **バックエンドから学習フローをリアルタイム制御可能**

---

## 推奨運用

* API側で次に出すべきUI構造・出題内容を動的に生成
* フロント側は純粋な描画マシンとして設計図に従う
* UIキットは最小限の責務と状態のみを保持

---

## 将来拡張例

* `type: "multiple_choice"` などを追加し、他形式への展開
* `props` にレイアウト指定を追加（例：2カラムなど）
* `DynamicRenderer` でzod等による型チェック導入
* セッション内進行度や履歴を用いた出題制御（メタ構造）

---
